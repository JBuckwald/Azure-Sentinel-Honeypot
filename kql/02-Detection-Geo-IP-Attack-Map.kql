// KQL Query to join SecurityEvents with a Geo-IP Watchlist
// This enriches failed logon data (EventID 4625) with geographic locations
let GeoIP_Map = _GetWatchlist('geoip');
SecurityEvent
| where EventID == "4625"
| order by TimeGenerated desc

// Perform the lookup
| evaluate ipv4_lookup(GeoIP_Map, IpAddress, network)

// Project the columns needed for the map
| project TimeGenerated, Computer, AttackerIP = IpAddress, cityname, countryname, latitude, longitude